--------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  D:\GSEFM\WS_20_21\Heterogenous Agent Models\Projects\Project4\stata_output\project4.l
> og
  log type:  text
 opened on:   5 Jan 2021, 11:00:21

. use "$data\PANEL6812_HH.dta",replace
(PSID Panel 1968-2012; unit: hh)

. save "$output\data_project4_clean.dta",replace
file D:\GSEFM\WS_20_21\Heterogenous Agent Models\Projects\Project4\stata_output\data_project4_clea
> n.dta saved

. 
. 
. ********************************************************************************
. * Basica data cleaning
. ********************************************************************************
. 
. *1) Focus on household with household heads in age range 25 to 60 according to 
. // variable age_head
.  keep if age_head >= 25 & age_head <= 60
(43,134 observations deleted)

. 
. *sum age_head 
.  
. *2) Deflate income with cpi(household pre-government earnings (income) and 
. // household post-government earnings (income))
. *3) Define log income (call it ln_inc) 
. 
. forvalues i=5(1)6{
  2.  gen deflated_yhh`i' = yhh`i'/cpi
  3.  gen ln_yhh`i' = log(deflated_yhh`i')
  4.  }
(5,936 missing values generated)
(2,635 missing values generated)

.  
.  save "$output\data_project4_clean.dta",replace
file D:\GSEFM\WS_20_21\Heterogenous Agent Models\Projects\Project4\stata_output\data_project4_clea
> n.dta saved

.  
. ********************************************************************************
. * FIRST STAGE ESTIMATION
. ********************************************************************************
.  
. *1) Choose a degree 3 (a cubic) polynomial in age, variable age_head
. gen age_head_squared = age_head^2

. gen age_head_cubed = age_head^3

.  
. *2) Choose a family size
. sum famsize

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     famsize |    100,941     3.02868    1.506988          1         14

. 
. *3) Dummy for married (married)
. sum married

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     married |    100,923    .7106903    .4534442          0          1

. 
. *4) Dummy for college and high-school but no college
. 
. gen educ = Educ

. sum educ

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
        educ |    100,941    13.61888    2.587212          0         17

. tab educ

       educ |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        144        0.14        0.14
          1 |         14        0.01        0.16
          2 |         56        0.06        0.21
          3 |        132        0.13        0.34
          4 |        161        0.16        0.50
          5 |        157        0.16        0.66
          6 |        309        0.31        0.96
          7 |        745        0.74        1.70
          8 |      2,144        2.12        3.83
          9 |      1,616        1.60        5.43
         10 |      2,736        2.71        8.14
         11 |      3,604        3.57       11.71
         12 |     31,322       31.03       42.74
         13 |      6,816        6.75       49.49
         14 |     12,856       12.74       62.23
         15 |      4,933        4.89       67.11
         16 |     15,800       15.65       82.77
         17 |     17,396       17.23      100.00
------------+-----------------------------------
      Total |    100,941      100.00

. 
. gen d_coll = 0

. replace d_coll = 1 if educ>= 16 
(33,196 real changes made)

. gen d_hs = 0

. replace d_hs = 1 if educ >= 12 & educ < 16
(55,927 real changes made)

. 
. sum d_coll d_hs 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      d_coll |    100,941    .3288654    .4698033          0          1
        d_hs |    100,941    .5540563    .4970718          0          1

.  
. *5) interactions of the dummies d_coll and d_hs with the age polynomial
. 
.  gen age_dcoll  = d_coll*age_head

.  gen age_dhs    = d_hs*age_head

.  
.  gen age2_dcoll  = d_coll*age_head_squared

.  gen age2_dhs    = d_hs*age_head_squared

.  
.  gen age3_dcoll  = d_coll*age_head_cubed

.  gen age3_dhs    = d_hs*age_head_cubed

.   
.  tsset persnr year
       panel variable:  persnr (unbalanced)
        time variable:  year, 1967 to 2012, but with gaps
                delta:  1 unit

.  
.  * Predicted values and residual variances
.  
.  local controls = "age_head age_head_squared age_head_cubed famsize married d_coll d_hs age_dcol
> l age_dhs age2_dcoll age2_dhs age3_dcoll age3_dhs"

. 
.  forvalues i=5(1)6{
  2.  
.         * We did not copy the command 1:1 because age* also includes variables that 
.         // are not part of the set of controls above(age_wife, age_youngest_child, agex)
.          xtreg ln_yhh`i' `controls' i.year , i(persnr) fe robust cluster(persnr)
  3.          
.          *predict values of yhh`i' and residuals
.          predict ln_yhh`i'_hat
  4.          gen ln_yhh`i'_tilde = ln_yhh`i' - ln_yhh`i'_hat
  5.          
.          *residual variance for yhh`i'
.          egen var_ln_yhh`i'_tilde = sd(ln_yhh`i'_tilde)
  6.          replace var_ln_yhh`i'_tilde = var_ln_yhh`i'_tilde^2
  7.  }
note: 2012.year omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =     94,996
Group variable: persnr                          Number of groups  =     10,590

R-sq:                                           Obs per group:
     within  = 0.1142                                         min =          1
     between = 0.2361                                         avg =        9.0
     overall = 0.2114                                         max =         33

                                                F(49,10589)       =      70.14
corr(u_i, Xb)  = 0.1994                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 10,590 clusters in persnr)
----------------------------------------------------------------------------------
                 |               Robust
         ln_yhh5 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
        age_head |   .1275739   .0777564     1.64   0.101    -.0248433     .279991
age_head_squared |  -.0017232   .0018633    -0.92   0.355    -.0053756    .0019293
  age_head_cubed |   4.36e-06   .0000144     0.30   0.762    -.0000239    .0000326
         famsize |  -.0380171   .0043709    -8.70   0.000    -.0465848   -.0294494
         married |   .4908439   .0176808    27.76   0.000     .4561863    .5255016
          d_coll |  -1.672272    1.16137    -1.44   0.150    -3.948776    .6042307
            d_hs |   .7490347   1.101852     0.68   0.497    -1.410803    2.908873
       age_dcoll |   .1059049   .0858721     1.23   0.217    -.0624204    .2742303
         age_dhs |  -.0414291   .0819115    -0.51   0.613    -.2019911    .1191329
      age2_dcoll |  -.0019442   .0020694    -0.94   0.347    -.0060007    .0021122
        age2_dhs |   .0008744   .0019728     0.44   0.658    -.0029926    .0047414
      age3_dcoll |   .0000134   .0000161     0.83   0.405    -.0000181    .0000449
        age3_dhs |  -5.34e-06   .0000153    -0.35   0.728    -.0000354    .0000247
                 |
            year |
           1968  |   .0103191   .0116505     0.89   0.376    -.0125181    .0331563
           1969  |   -.004674   .0139748    -0.33   0.738    -.0320673    .0227193
           1970  |  -.0353987   .0167404    -2.11   0.034     -.068213   -.0025844
           1971  |   -.043483   .0176453    -2.46   0.014    -.0780712   -.0088948
           1972  |  -.0026932   .0170399    -0.16   0.874    -.0360947    .0307083
           1973  |   .0281029   .0170397     1.65   0.099    -.0052981    .0615039
           1974  |  -.0316633   .0181822    -1.74   0.082    -.0673039    .0039773
           1975  |  -.0892155   .0196794    -4.53   0.000    -.1277909   -.0506401
           1976  |  -.1073642   .0210004    -5.11   0.000    -.1485289   -.0661995
           1977  |  -.0424747   .0210427    -2.02   0.044    -.0837224    -.001227
           1978  |  -.0309735   .0216055    -1.43   0.152    -.0733243    .0113774
           1979  |  -.0025168   .0197598    -0.13   0.899    -.0412497    .0362161
           1980  |  -.0556159   .0206063    -2.70   0.007    -.0960081   -.0152237
           1981  |  -.0909205   .0210844    -4.31   0.000    -.1322498   -.0495912
           1982  |  -.1319629   .0207703    -6.35   0.000    -.1726765   -.0912493
           1983  |  -.1305845   .0205867    -6.34   0.000    -.1709383   -.0902308
           1984  |  -.0834625   .0206943    -4.03   0.000    -.1240271   -.0428978
           1985  |  -.0806312   .0205724    -3.92   0.000     -.120957   -.0403053
           1986  |  -.0777335   .0203356    -3.82   0.000    -.1175951   -.0378719
           1987  |  -.0479231   .0193595    -2.48   0.013    -.0858713   -.0099749
           1988  |  -.0321289   .0186075    -1.73   0.084    -.0686032    .0043453
           1989  |  -.0483399   .0187467    -2.58   0.010     -.085087   -.0115928
           1990  |  -.0582638   .0185447    -3.14   0.002    -.0946148   -.0219128
           1991  |  -.1012629   .0194344    -5.21   0.000     -.139358   -.0631678
           1992  |   -.049468   .0182816    -2.71   0.007    -.0853034   -.0136326
           1993  |  -.0877556   .0194363    -4.52   0.000    -.1258544   -.0496568
           1994  |  -.0687691   .0188423    -3.65   0.000    -.1057035   -.0318346
           1995  |  -.0603505   .0195141    -3.09   0.002    -.0986018   -.0220992
           1996  |  -.0632486   .0190188    -3.33   0.001    -.1005291    -.025968
           1998  |   .0282265    .017491     1.61   0.107    -.0060592    .0625121
           2000  |    .085547   .0158579     5.39   0.000     .0544626    .1166314
           2002  |   .0689806   .0160228     4.31   0.000     .0375729    .1003883
           2004  |    .070077   .0152662     4.59   0.000     .0401523    .1000017
           2006  |   .0916313   .0142212     6.44   0.000      .063755    .1195076
           2008  |   .0701775   .0139813     5.02   0.000     .0427714    .0975835
           2010  |  -.0085106   .0129859    -0.66   0.512    -.0339654    .0169443
           2012  |          0  (omitted)
                 |
           _cons |   7.870766   1.051089     7.49   0.000     5.810434    9.931098
-----------------+----------------------------------------------------------------
         sigma_u |   .8332614
         sigma_e |  .57887121
             rho |  .67448365   (fraction of variance due to u_i)
----------------------------------------------------------------------------------
(option xb assumed; fitted values)
(18 missing values generated)
(5,945 missing values generated)
(100,941 real changes made)
note: 2012.year omitted because of collinearity

Fixed-effects (within) regression               Number of obs     =     98,297
Group variable: persnr                          Number of groups  =     10,779

R-sq:                                           Obs per group:
     within  = 0.1124                                         min =          1
     between = 0.3039                                         avg =        9.1
     overall = 0.2431                                         max =         33

                                                F(49,10778)       =      81.53
corr(u_i, Xb)  = 0.2299                         Prob > F          =     0.0000

                                (Std. Err. adjusted for 10,779 clusters in persnr)
----------------------------------------------------------------------------------
                 |               Robust
         ln_yhh6 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
        age_head |   .0749795   .0616903     1.22   0.224    -.0459448    .1959038
age_head_squared |  -.0008003    .001487    -0.54   0.590    -.0037151    .0021144
  age_head_cubed |  -8.32e-07   .0000116    -0.07   0.943    -.0000236    .0000219
         famsize |  -.0044363   .0039595    -1.12   0.263    -.0121976    .0033251
         married |    .509292   .0167149    30.47   0.000     .4765277    .5420563
          d_coll |  -1.425696   .9561701    -1.49   0.136    -3.299965    .4485736
            d_hs |   .4654055   .8878188     0.52   0.600    -1.274883    2.205694
       age_dcoll |   .0865209    .071174     1.22   0.224    -.0529932     .226035
         age_dhs |  -.0274061   .0663724    -0.41   0.680    -.1575082    .1026959
      age2_dcoll |  -.0014958   .0017263    -0.87   0.386    -.0048796     .001888
        age2_dhs |   .0006511    .001611     0.40   0.686    -.0025068     .003809
      age3_dcoll |   9.05e-06   .0000135     0.67   0.504    -.0000175    .0000356
        age3_dhs |  -5.30e-06   .0000127    -0.42   0.676    -.0000301    .0000195
                 |
            year |
           1968  |   .0207083   .0124042     1.67   0.095    -.0036061    .0450228
           1969  |   .0475035   .0138089     3.44   0.001     .0204354    .0745715
           1970  |   .0407368   .0165188     2.47   0.014      .008357    .0731166
           1971  |   .0416378   .0170076     2.45   0.014     .0082998    .0749757
           1972  |   .0853252   .0168428     5.07   0.000     .0523102    .1183403
           1973  |   .1170734   .0163641     7.15   0.000     .0849968    .1491499
           1974  |   .0740207   .0175519     4.22   0.000     .0396158    .1084257
           1975  |   .0208138   .0192564     1.08   0.280    -.0169322    .0585598
           1976  |   .0202606   .0200284     1.01   0.312    -.0189987      .05952
           1977  |  -.1859534   .0194321    -9.57   0.000    -.2240438    -.147863
           1978  |  -.1935086   .0205599    -9.41   0.000    -.2338099   -.1532074
           1979  |   -.162673   .0186692    -8.71   0.000    -.1992681    -.126078
           1980  |  -.2135749   .0195621   -10.92   0.000    -.2519202   -.1752295
           1981  |  -.2655552   .0198518   -13.38   0.000    -.3044683   -.2266422
           1982  |  -.2650981   .0190407   -13.92   0.000    -.3024214   -.2277748
           1983  |  -.2670136   .0193485   -13.80   0.000    -.3049403   -.2290869
           1984  |  -.2286272   .0196774   -11.62   0.000    -.2671985   -.1900559
           1985  |  -.2160314   .0190344   -11.35   0.000    -.2533424   -.1787205
           1986  |  -.2154134   .0192842   -11.17   0.000     -.253214   -.1776128
           1987  |  -.1609757   .0186276    -8.64   0.000    -.1974892   -.1244623
           1988  |   -.145271   .0183819    -7.90   0.000    -.1813029   -.1092391
           1989  |  -.1546118   .0185073    -8.35   0.000    -.1908896   -.1183341
           1990  |  -.1488804   .0177706    -8.38   0.000    -.1837141   -.1140468
           1991  |  -.1816421   .0185656    -9.78   0.000     -.218034   -.1452502
           1992  |  -.1066592     .01772    -6.02   0.000    -.1413937   -.0719246
           1993  |  -.1605847   .0185356    -8.66   0.000    -.1969178   -.1242516
           1994  |  -.1588464    .018997    -8.36   0.000     -.196084   -.1216089
           1995  |  -.1471699   .0195008    -7.55   0.000     -.185395   -.1089447
           1996  |   -.134664   .0189481    -7.11   0.000    -.1718057   -.0975223
           1998  |  -.0344067   .0174157    -1.98   0.048    -.0685447   -.0002687
           2000  |   .0038815   .0168976     0.23   0.818    -.0292409     .037004
           2002  |   .0369842   .0168962     2.19   0.029     .0038646    .0701038
           2004  |   .0724241   .0159209     4.55   0.000     .0412161    .1036321
           2006  |    .007974   .0192069     0.42   0.678    -.0296751    .0456232
           2008  |   .0963149   .0145888     6.60   0.000     .0677181    .1249117
           2010  |   .0652951   .0139322     4.69   0.000     .0379855    .0926048
           2012  |          0  (omitted)
                 |
           _cons |   8.583615   .8302458    10.34   0.000     6.956181    10.21105
-----------------+----------------------------------------------------------------
         sigma_u |   .6968219
         sigma_e |   .5638687
             rho |  .60430058   (fraction of variance due to u_i)
----------------------------------------------------------------------------------
(option xb assumed; fitted values)
(18 missing values generated)
(2,644 missing values generated)
(100,941 real changes made)

.  
.  
.  ********************************************************************************
.  * Interpret these variances of residual log incomes!
.  
.  forvalues i=5(1)6{
  2.          display "residual variance ln_yy`i'_tilde:" as result var_ln_yhh`i'_tilde[1]
  3. }
residual variance ln_yy5_tilde:.72517049
residual variance ln_yy6_tilde:.60099632

. 
end of do-file

. do "C:\Users\ZUCKER~1\AppData\Local\Temp\STD312c_000000.tmp"

. *Regress predicted values on degree 3 polynomial and a dummy for married
. 
.  
.   forvalues i=5(1)6{
  2.          reg ln_yhh`i'_hat age_head age_head_squared age_head_cubed married
  3.          predict smoothed_yhh`i'_hat
  4.          *twoway scatter smoothed_yhh`i'_hat age_head, title(Scatter plot for `: variable lab
> el yhh`i'') legend(size(medsmall))
.          graph twoway (scatter smoothed_yhh`i'_hat age_head if married==0) (scatter smoothed_yhh
> `i'_hat age_head if married==1), title(Scatter plot for `: variable label yhh`i'') legend(label(
> 1 not married) label(2 married)) 
  5.          graph export "$output\smoothed_yy`i'_hat.png", replace
  6. }

      Source |       SS           df       MS      Number of obs   =   100,923
-------------+----------------------------------   F(4, 100918)    =  93616.91
       Model |  7622.77744         4  1905.69436   Prob > F        =    0.0000
    Residual |  2054.31766   100,918  .020356306   R-squared       =    0.7877
-------------+----------------------------------   Adj R-squared   =    0.7877
       Total |  9677.09509   100,922  .095886874   Root MSE        =    .14268

----------------------------------------------------------------------------------
     ln_yhh5_hat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
        age_head |   .0861011   .0026996    31.89   0.000     .0808099    .0913923
age_head_squared |  -.0006384   .0000662    -9.64   0.000    -.0007682   -.0005086
  age_head_cubed |  -3.50e-06   5.25e-07    -6.67   0.000    -4.53e-06   -2.47e-06
         married |   .4370217   .0009947   439.35   0.000     .4350722    .4389713
           _cons |    8.36501   .0354458   235.99   0.000     8.295537    8.434484
----------------------------------------------------------------------------------
(option xb assumed; fitted values)
(18 missing values generated)
(file D:\GSEFM\WS_20_21\Heterogenous Agent Models\Projects\Project4\stata_output\smoothed_yy5_hat.
> png written in PNG format)

      Source |       SS           df       MS      Number of obs   =   100,923
-------------+----------------------------------   F(4, 100918)    =  87967.29
       Model |  7280.13249         4  1820.03312   Prob > F        =    0.0000
    Residual |  2087.98175   100,918  .020689884   R-squared       =    0.7771
-------------+----------------------------------   Adj R-squared   =    0.7771
       Total |  9368.11423   100,922  .092825293   Root MSE        =    .14384

----------------------------------------------------------------------------------
     ln_yhh6_hat |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
        age_head |   .0405944   .0027216    14.92   0.000       .03526    .0459288
age_head_squared |   .0002557   .0000668     3.83   0.000     .0001248    .0003865
  age_head_cubed |  -.0000102   5.29e-07   -19.28   0.000    -.0000112   -9.17e-06
         married |   .5084652   .0010028   507.04   0.000     .5064997    .5104307
           _cons |   8.885294    .035735   248.64   0.000     8.815253    8.955334
----------------------------------------------------------------------------------
(option xb assumed; fitted values)
(18 missing values generated)
(file D:\GSEFM\WS_20_21\Heterogenous Agent Models\Projects\Project4\stata_output\smoothed_yy6_hat.
> png written in PNG format)

.  
.  save "$output\data_project4_clean.dta",replace
file D:\GSEFM\WS_20_21\Heterogenous Agent Models\Projects\Project4\stata_output\data_project4_clea
> n.dta saved

.  
.  
. hist Hrs_hh
(bin=50, start=0, width=222.68)

. graph export "$output\Hrs_hh.png", replace
(file D:\GSEFM\WS_20_21\Heterogenous Agent Models\Projects\Project4\stata_output\Hrs_hh.png writte
> n in PNG format)

. 
. hist Hrs_hh if married == 0
(bin=44, start=0, width=132.72727)

. graph export "$output\Hrs_hh_nm.png", replace
(file D:\GSEFM\WS_20_21\Heterogenous Agent Models\Projects\Project4\stata_output\Hrs_hh_nm.png wri
> tten in PNG format)

. 
. hist Hrs_hh if married == 1
(bin=48, start=0, width=231.95833)

. graph export "$output\Hrs_hh_m.png", replace
(file D:\GSEFM\WS_20_21\Heterogenous Agent Models\Projects\Project4\stata_output\Hrs_hh_m.png writ
> ten in PNG format)

. 
end of do-file

. do "C:\Users\ZUCKER~1\AppData\Local\Temp\STD312c_000000.tmp"

. 
. clear all  

. use "$output\data_project4_clean.dta",replace
(PSID Panel 1968-2012; unit: hh)

. 
. * Since the PSID was cast at an annual frequency only until 1997, we want to 
. // exclude all later years
. drop if year > 1997
(29,121 observations deleted)

. tab year

       year |      Freq.     Percent        Cum.
------------+-----------------------------------
       1967 |      1,817        2.53        2.53
       1968 |      1,604        2.23        4.76
       1969 |      1,625        2.26        7.03
       1970 |      1,642        2.29        9.31
       1971 |      1,708        2.38       11.69
       1972 |      1,769        2.46       14.15
       1973 |      1,827        2.54       16.70
       1974 |      2,041        2.84       19.54
       1975 |      2,084        2.90       22.44
       1976 |      2,174        3.03       25.47
       1977 |      2,235        3.11       28.58
       1978 |      2,298        3.20       31.78
       1979 |      2,394        3.33       35.11
       1980 |      2,446        3.41       38.52
       1981 |      2,494        3.47       41.99
       1982 |      2,534        3.53       45.52
       1983 |      2,559        3.56       49.08
       1984 |      2,433        3.39       52.47
       1985 |      2,473        3.44       55.91
       1986 |      2,529        3.52       59.43
       1987 |      2,546        3.54       62.98
       1988 |      2,513        3.50       66.48
       1989 |      2,551        3.55       70.03
       1990 |      2,743        3.82       73.85
       1991 |      2,833        3.94       77.79
       1992 |      2,954        4.11       81.91
       1993 |      3,240        4.51       86.42
       1994 |      3,227        4.49       90.91
       1995 |      3,238        4.51       95.42
       1996 |      3,289        4.58      100.00
------------+-----------------------------------
      Total |     71,820      100.00

. 
. /* 
> Note: we need to decide on which measure of income to use!
> Let's use yy5 i.e. Pre-Government HH Labor Income + .5 Payroll Tax (PRE)
> precisely, let's use the residual of the logged and deflated yy5 measure after 
> deducting it's predicted values
> */
. 
. * Define income measure we want to use!
. gen res_ln_inc = ln_yhh5_tilde
(4,315 missing values generated)

. 
. * second stage regression of residual on its lag
. sort persnr year

. xtset persnr year 
       panel variable:  persnr (unbalanced)
        time variable:  year, 1967 to 1996, but with gaps
                delta:  1 unit

. rename res_ln_inc rsd

. su rsd

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         rsd |     67,505   -.0319351    .8496019   -10.9039   3.029265

. 
. * Generate lead variables:
. gen rsd1 = F.rsd 
(11,662 missing values generated)

. gen rsd2 = F2.rsd 
(17,759 missing values generated)

. 
. * Generate empirical moments.
. * Note that in the sample we will consider now, Age = age_head in all cases
. gen m00 = rsd^2 
(4,315 missing values generated)

. gen m10 = rsd1^2
(11,662 missing values generated)

. gen m01 = rsd*rsd1 
(12,775 missing values generated)

. gen m02 = rsd*rsd2 
(18,932 missing values generated)

. * The next command gives you the mean m00-m02 measures for each age-year pair
. collapse (mean) m00 m10 m01 m02 [w=fwgt], by(Age year) 
(analytic weights assumed)

. 
. 
. ***************************************************
. * Carry out GMM estimation.
. 
.         gmm ///
>                 (mj0: m00 - {rho}^(2*(Age-$MinAge+1))*{var_z} - {var_nu}*(1-{rho}^(2*(Age-$MinAg
> e+1)))/(1-{rho}^2) - {var_epsi} ) ///
>                 (mjp10: m10 - {rho}^(2*(Age-$MinAge+2))*{var_z} - {var_nu}*(1-{rho}^(2*(Age-$Min
> Age+2)))/(1-{rho}^2) - {var_epsi} ) ///
>                 (mj1: m01 - {rho}*({rho}^(2*(Age-$MinAge+1))*{var_z} + {var_nu}*(1-{rho}^(2*(Age
> -$MinAge+1)))/(1-{rho}^2)) ) ///
>                 (mj2: m02 - {rho}^2*({rho}^(2*(Age-$MinAge+1))*{var_z} + {var_nu}*(1-{rho}^(2*(A
> ge-$MinAge+1)))/(1-{rho}^2)) ), ///
>                 instruments(Age, noconstant) instruments(mj0: m00, noconstant) ///
>                 instruments(mjp10: m10, noconstant) ///
>                 instruments(mj1: m01, noconstant) ///
>                 instruments(mj2: m02, noconstant) ///
>                 winitial(identity) from(rho 0.9 var_z 0.3 var_nu 0.03 var_epsi 0.03) onestep

Step 1
Iteration 0:   GMM criterion Q(b) =  1350.1377  
Iteration 1:   GMM criterion Q(b) =  365.53993  
Iteration 2:   GMM criterion Q(b) =  2.4331636  
Iteration 3:   GMM criterion Q(b) =  .05454281  
Iteration 4:   GMM criterion Q(b) =  .04825389  
Iteration 5:   GMM criterion Q(b) =  .04825384  

GMM estimation 

Number of parameters =   4
Number of moments    =   8
Initial weight matrix: Identity                   Number of obs   =        952

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        /rho |   .9088825   .0151314    60.07   0.000     .8792255    .9385395
      /var_z |   16.15252   69.36648     0.23   0.816    -119.8033    152.1083
     /var_nu |   .0861262   .0185558     4.64   0.000     .0497575    .1224949
   /var_epsi |   .2144817   .0164309    13.05   0.000     .1822778    .2466856
------------------------------------------------------------------------------
Instruments for equation mj0: Age m00
Instruments for equation mjp10: Age m10
Instruments for equation mj1: Age m01
Instruments for equation mj2: Age m02

.         mat rt = e(b) 

.         
. 
end of do-file

. do "C:\Users\ZUCKER~1\AppData\Local\Temp\STD312c_000000.tmp"

. 
. clear all  

. use "$output\data_project4_clean.dta",replace
(PSID Panel 1968-2012; unit: hh)

. 
. * Since the PSID was cast at an annual frequency only until 1997, we want to exclude
. * all later years
. drop if year > 1997
(29,121 observations deleted)

. 
. /* Note: we need to decide on which measure of income to use!
> Let's use yy6 i.e. Pre-Government HH Labor Income + .5 Payroll Tax +Transfers - Taxes (POST)
> precisely, let's use the residual of the logged and deflated yy6 measure after deducting it's pr
> edicted values
> */
. 
. * Define income measure we want to use!
. gen res_ln_inc = ln_yhh6_tilde
(2,106 missing values generated)

. 
. * second stage regression of residual on its lag
. sort persnr year

. xtset persnr year 
       panel variable:  persnr (unbalanced)
        time variable:  year, 1967 to 1996, but with gaps
                delta:  1 unit

. rename res_ln_inc rsd

. su rsd

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         rsd |     69,714   -.0073918    .7504852  -10.57797   3.066704

. 
. * Generate lead variables:
. gen rsd1 = F.rsd 
(9,691 missing values generated)

. gen rsd2 = F2.rsd 
(15,971 missing values generated)

. 
. * Generate empirical moments.
. * Note that in the sample we will consider now, Age = age_head in all cases
. gen m00 = rsd^2 
(2,106 missing values generated)

. gen m10 = rsd1^2
(9,691 missing values generated)

. gen m01 = rsd*rsd1 
(10,527 missing values generated)

. gen m02 = rsd*rsd2 
(16,859 missing values generated)

. * The next command gives you the mean m00-m02 measures for each age-year pair
. collapse (mean) m00 m10 m01 m02 [w=fwgt], by(Age year) 
(analytic weights assumed)

. 
. 
. ***************************************************
. * Carry out GMM estimation.
. 
.         gmm ///
>                 (mj0: m00 - {rho}^(2*(Age-$MinAge+1))*{var_z} - {var_nu}*(1-{rho}^(2*(Age-$MinAg
> e+1)))/(1-{rho}^2) - {var_epsi} ) ///
>                 (mjp10: m10 - {rho}^(2*(Age-$MinAge+2))*{var_z} - {var_nu}*(1-{rho}^(2*(Age-$Min
> Age+2)))/(1-{rho}^2) - {var_epsi} ) ///
>                 (mj1: m01 - {rho}*({rho}^(2*(Age-$MinAge+1))*{var_z} + {var_nu}*(1-{rho}^(2*(Age
> -$MinAge+1)))/(1-{rho}^2)) ) ///
>                 (mj2: m02 - {rho}^2*({rho}^(2*(Age-$MinAge+1))*{var_z} + {var_nu}*(1-{rho}^(2*(A
> ge-$MinAge+1)))/(1-{rho}^2)) ), ///
>                 instruments(Age, noconstant) instruments(mj0: m00, noconstant) ///
>                 instruments(mjp10: m10, noconstant) ///
>                 instruments(mj1: m01, noconstant) ///
>                 instruments(mj2: m02, noconstant) ///
>                 winitial(identity) from(rho 0.9 var_z 0.3 var_nu 0.03 var_epsi 0.03) onestep

Step 1
Iteration 0:   GMM criterion Q(b) =  678.96248  
Iteration 1:   GMM criterion Q(b) =  245.53882  
Iteration 2:   GMM criterion Q(b) =   1.130624  
Iteration 3:   GMM criterion Q(b) =  .02271491  
Iteration 4:   GMM criterion Q(b) =  .02152759  
Iteration 5:   GMM criterion Q(b) =  .02152758  

GMM estimation 

Number of parameters =   4
Number of moments    =   8
Initial weight matrix: Identity                   Number of obs   =        952

------------------------------------------------------------------------------
             |               Robust
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
        /rho |   .9080964   .0137734    65.93   0.000     .8811011    .9350917
      /var_z |   41.87742   68.17502     0.61   0.539    -91.74316     175.498
     /var_nu |   .0644558   .0150432     4.28   0.000     .0349717    .0939399
   /var_epsi |   .1489496   .0121499    12.26   0.000     .1251362     .172763
------------------------------------------------------------------------------
Instruments for equation mj0: Age m00
Instruments for equation mjp10: Age m10
Instruments for equation mj1: Age m01
Instruments for equation mj2: Age m02

.         mat rt = e(b) 

. 
. 
end of do-file

. exit, clear
